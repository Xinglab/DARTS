# Readme for Darts BHT
### Author: "Zijun Zhang"
### Date: "3.17.2018"

### Table of Contents
1. [Installation](#installation)
2. [Testing](#testing)
3. [Using Darts BHT](#using-darts-bht)

### Installation
To install `Darts_BHT` R package, simply browse to the BHT folder and
type the following command in terminal:
```
make install
```
This will compile a few Rcpp files and prepare for loading. 
If finished successfully, you will see the following message
```
** building package indices
** testing if installed package can be loaded
* DONE (Darts)
```

You should also add `Darts` suite to your environment variables, by
adding the following line to your `.bash_profile` in `$HOME` directory:
```
export PATH=$HOME/.darts:$PATH
```

Now in your shell,  type
```
> source ~/.bash_profile
> Darts_BHT -h
Usage: Darts_BHT [-[-input|i] <character>] [-[-rho|r] [<character>]] [-[-out|o] <character>] [-[-cutoff|c] [<double>]] [-[-rep|k] [<integer>]] [-[-pool|m] [<logical>]] [-[-estim_gVar|g] [<logical>]] [-[-verbose|v] [<integer>]] [-[-help|h]]
    -i|--input         input file in Spider format (required)
    -r|--rho           prior file in Spider format (optional, if none then flat prior i.e. rho=0.5)
    -o|--out           output directory (required)
    -c|--cutoff        Cutoff of Posterior probability, must be in (0,1) (optional, default=0.05)
    -k|--rep           run replicate [pair/unpair] model (optional, 0:no replicate, 1:unpaired, 2:paired, default=0)
    -m|--pool          merge the replicates, valid only when rep>0, default: FALSE
    -g|--estim_gVar    Use prior to estimate within group variance, default: FALSE
    -v|--verbose       verbose mode (optional, 0:non-verbose, 1:summary, 2:every 200, default=0)
    -h|--help          print this help message and exit

```

### Testing
Now let's do a few quick checks to make sure the installed
`Darts_BHT` R package works. There are a few built-in testing 
functions in `Darts` package. Open a new R interactive session, 
and run following code:
```{r}
library(Darts)
set.seed(101)
t1=test_sim_darts(covg=200)
print(t1)
```
If you are not familiar with the RNA-seq splicing anlaysis, this is also a good time for
you to get to know what's going on. See [Here](#) for a quick tutorial.

Also a quick test on replicate model; we will dive deeper into it in the [Benchmarking](#benchmark) section:
```{r}
t2=test_sim_rdarts(n=10, outlier=F)
print(t2$eval_df)
```

### Using Darts BHT

Now let's use a more wrapped-up script to call `Darts BHT`. The entry script is `Darts_pipeline.R`.
In the simplest case, you only need to give `Darts_BHT` the input file `-i` and output folder `-o`. The data files are
in the same format as rMATS, and can be generated by running rMATS w/ or w/o turning on the stat part.

For example, using the data file provided in the `test_data` folder:
```
Rscripts Darts_pipeline.R -i test_data/test_norep_data.txt -o test_data/
```

For more details of the wrapper script, run
```
> Rscript Darts_pipeline.R -h

Usage: /u/home/f/frankwoe/nobackup/src/Darts/DARTS/Darts_BHT/Darts_pipeline.R [-[-input|i] <character>] [-[-rho|r] [<character>]] [-[-out|o] <character>] [-[-cutoff|c] [<double>]] [-[-rep|k] [<integer>]] [-[-pool|m] [<logical>]] [-[-estim_gVar|g] [<logical>]] [-[-verbose|v] [<integer>]] [-[-help|h]]
    -i|--input         input file in Spider format (required)
    -r|--rho           prior file in Spider format (optional, if none then flat prior i.e. rho=0.5)
    -o|--out           output directory (required)
    -c|--cutoff        Cutoff of Posterior probability, must be in (0,1) (optional, default=0.05)
    -k|--rep           run replicate [pair/unpair] model (optional, 0:no replicate, 1:unpaired, 2:paired, default=0)
    -m|--pool          merge the replicates, valid only when rep>0, default: FALSE
    -g|--estim_gVar    Use prior to estimate within group variance, default: FALSE
    -v|--verbose       verbose mode (optional, 0:non-verbose, 1:summary, 2:every 200, default=0)
    -h|--help          print this help message and exit

```
